const {SerialPort} = require('serialport');

let t_data = [
    '-Y',

    '23-12-11 19:54:',

    '04 ID=001  21.03',

    '8Lt/m 1.98m/s To',

    't=     159.57Lt',

    'Tim=000000h20---',

    '-c',

    '23-12-11 19:54:',

    '05 ID=001  21.03',

    '8Lt/m 1.98m/s To',

    't=     159.92Lt',

    'Tim=000000h20---',

    '-c',

    '23-12-11 19:54:',

    '06 ID=001  21.04',

    '2Lt/m 1.98m/s To',

    't=     160.27Lt',

    'Tim=000000h20---',

    '-U',

    '23-12-11 19:54:',

    '07 ID=001  21.05',

    '2Lt/m 1.98m/s To',

    't=     160.62Lt',

    'Tim=000000h20---',

    '-V',

    '23-12-11 19:54:',

    '07 ID=001  21.07',

    '0Lt/m 1.98m/s To',

    't=     160.98Lt',

    'Tim=000000h20---',

    '-_',

    '23-12-11 19:54:',

    '09 ID=001  21.09',

    '6Lt/m 1.98m/s To',

    't=     161.33Lt',

    'Tim=000000h20---',

    '-_',

    '23-12-11 19:54:',

    '10 ID=001  21.11',

    '9Lt/m 1.99m/s To',

    't=     161.68Lt',

    'Tim=000000h20---',

    "-\'",

    '23-12-11 19:54:',

    '11 ID=001  21.13',

    '5Lt/m 1.99m/s To',

    't=     162.03Lt',

    'Tim=000000h20---',

    '-Q',

    '23-12-11 19:54:',

    '12 ID=001  21.14',

    '2Lt/m 1.99m/s To',

    't=     162.38Lt',

    'Tim=000000h20---',

    '-X',

    '23-12-11 19:54:',

    '13 ID=001  21.14',

    '1Lt/m 1.99m/s To',

    't=     162.74Lt',

    'Tim=000000h20---',

    '-X',

    '23-12-11 19:54:',

    '14 ID=001  21.13',

    '9Lt/m 1.99m/s To',

    't=     163.09Lt',

    'Tim=000000h20---',

    '-_',

    '23-12-11 19:54:',

    '15 ID=001  21.13',

    '8Lt/m 1.99m/s To',

    't=     163.44Lt',

    'Tim=000000h20---',

    '-^',

    '23-12-11 19:54:',

    '16 ID=001  21.13',

    '3Lt/m 1.99m/s To',

    't=     163.79Lt',

    'Tim=000000h20---',

    '-b',

    '23-12-11 19:54:',

    '17 ID=001  21.12',

    '6Lt/m 1.99m/s To',

    't=     164.15Lt',

    'Tim=000000h20---',

    "-\'",

    '23-12-11 19:54:',

    '18 ID=001  21.12',

    '0Lt/m 1.99m/s To',

    't=     164.50Lt',

    'Tim=000000h20---',

    '-V',

    '23-12-11 19:54:',

    '19 ID=001  21.11',

    '2Lt/m 1.99m/s To',

    't=     164.85Lt',

    'Tim=000000h20---',

    '-`',

    '23-12-11 19:54:',

    '20 ID=001  21.10',

    '6Lt/m 1.99m/s To',

    't=     165.20Lt',

    'Tim=000000h20---',

    '-Q',

    '23-12-11 19:54:',

    '21 ID=001  21.10',

    '7Lt/m 1.99m/s To',

    't=     165.55Lt',

    'Tim=000000h20---',

    '-[',

    '23-12-11 19:54:',

    '22 ID=001  21.11',

    '4Lt/m 1.99m/s To',

    't=     165.90Lt',

    'Tim=000000h20---',

    '-Y',

    '23-12-11 19:54:',

    '23 ID=001  21.12',

    '4Lt/m 1.99m/s To',

    't=     166.26Lt',

    'Tim=000000h20---',

    '-[',

    '23-12-11 19:54:',

    '24 ID=001  21.13',

    '5Lt/m 1.99m/s To',

    't=     166.61Lt',

    'Tim=000000h20---',

    '-]',

    '23-12-11 19:54:',

    '25 ID=001  21.14',

    '8Lt/m 1.99m/s To',

    't=     166.96Lt',

    'Tim=000000h20---',

    '-j',

    '23-12-11 19:54:',

    '26 ID=001  21.15',

    '8Lt/m 1.99m/s To',

    't=     167.31Lt',

    'Tim=000000h20---',

    '-b',

    '23-12-11 19:54:',

    '27 ID=001  21.16',

    '7Lt/m 1.99m/s To',

    't=     167.67Lt',

    'Tim=000000h20---',

    '-l',

    '23-12-11 19:54:',

    '28 ID=001  21.17',

    '1Lt/m 1.99m/s To',

    't=     168.02Lt',

    'Tim=000000h20---',

    '-^',

    '23-12-11 19:54:',

    '29 ID=001  21.17',

    '8Lt/m 1.99m/s To',

    't=     168.37Lt',

    'Tim=000000h20---',

    '-n',

    '23-12-11 19:54:',

    '30 ID=001  21.18',

    '4Lt/m 1.99m/s To',

    't=     168.73Lt',

    'Tim=000000h20---',

    '-c',

    '23-12-11 19:54:',

    '31 ID=001  21.19',

    '4Lt/m 1.99m/s To',

    't=     169.08Lt',

    'Tim=000000h20---',

    '-d',

    '23-12-11 19:54:',

    '32 ID=001  21.20',

    '3Lt/m 1.99m/s To',

    't=     169.43Lt',

    'Tim=000000h21---',

    "-\'",

    '23-12-11 19:54:',

    '33 ID=001  21.21',

    '1Lt/m 2.00m/s To',

    't=     169.79Lt',

    'Tim=000000h21---',

    '-T',

    '23-12-11 19:54:',

    '34 ID=001  21.21',

    '5Lt/m 2.00m/s To',

    't=     170.14Lt',

    'Tim=000000h21---',

    '-F',

    '23-12-11 19:54:',

    '35 ID=001  21.21',

    '3Lt/m 2.00m/s To',

    't=     170.49Lt',

    'Tim=000000h21---',

    '-M',

    '23-12-11 19:54:',

    '36 ID=001  21.21',

    '6Lt/m 2.00m/s To',

    't=     170.85Lt',

    'Tim=000000h21---',

    '-Q',

    '23-12-11 19:54:',

    '37 ID=001  21.22',

    '0Lt/m 2.00m/s To',

    't=     171.20Lt',

    'Tim=000000h21---',

    '-C',

    '23-12-11 19:54:',

    '38 ID=001  21.22',

    '6Lt/m 2.00m/s To',

    't=     171.55Lt',

    'Tim=000000h21---',

    '-R',

    '23-12-11 19:54:',

    '39 ID=001  21.23',

    '2Lt/m 2.00m/s To',

    't=     171.91Lt',

    'Tim=000000h21---',

    '-P',

    '23-12-11 19:54:',

    '40 ID=001  21.24',

    '2Lt/m 2.00m/s To',

    't=     172.26Lt',

    'Tim=000000h21---',

    '-H',

    '23-12-11 19:54:',

    '41 ID=001  21.24',

    '9Lt/m 2.00m/s To',

    't=     172.62Lt',

    'Tim=000000h21---',

    '-P',

    '23-12-11 19:54:',

    '42 ID=001  21.26',

    '0Lt/m 2.00m/s To',

    't=     172.97Lt',

    'Tim=000000h21---',

    '-R',

    '23-12-11 19:54:',

    '42 ID=001  21.26',

    '7Lt/m 2.00m/s To',

    't=     173.32Lt',

    'Tim=000000h21---',

    '-O',

    '23-12-11 19:54:',

    '44 ID=001  21.27',

    '6Lt/m 2.00m/s To',

    't=     173.68Lt',

    'Tim=000000h21---',

    '-Z',

    '23-12-11 19:54:',

    '45 ID=001  21.28',

    '1Lt/m 2.00m/s To',

    't=     174.03Lt',

    'Tim=000000h21---',

    '-M',

    '23-12-11 19:54:',

    '46 ID=001  21.27',

    '9Lt/m 2.00m/s To',

    't=     174.39Lt',

    'Tim=000000h21---',

    '-^',

    '23-12-11 19:54:',

    '47 ID=001  21.27',

    '7Lt/m 2.00m/s To',

    't=     174.74Lt',

    'Tim=000000h21---',

    "-\'",

    '23-12-11 19:54:',

    '48 ID=001  21.27',

    '4Lt/m 2.00m/s To',

    't=     175.10Lt',

    'Tim=000000h21---',

    '-Q',

    '23-12-11 19:54:',

    '49 ID=001  21.26',

    '7Lt/m 2.00m/s To',

    't=     175.45Lt',

    'Tim=000000h21---',

    "-\'",

    '23-12-11 19:54:',

    '50 ID=001  21.26',

    '3Lt/m 2.00m/s To',

    't=     175.81Lt',

    'Tim=000000h21---',

    '-P',

    '23-12-11 19:54:',

    '50 ID=001  21.26',

    '3Lt/m 2.00m/s To',

    't=     176.16Lt',

    'Tim=000000h21---',

    '-O',

    '23-12-11 19:54:',

    '52 ID=001  21.25',

    '7Lt/m 2.00m/s To',

    't=     176.52Lt',

    'Tim=000000h21---',

    '-T',

    '23-12-11 19:54:',

    '53 ID=001  21.25',

    '3Lt/m 2.00m/s To',

    't=     176.87Lt',

    'Tim=000000h21---',

    '-Y',

    '23-12-11 19:54:',

    '54 ID=001  21.25',

    '4Lt/m 2.00m/s To',

    't=     177.22Lt',

    'Tim=000000h21---',

    '-Q',

    '23-12-11 19:54:',

    '55 ID=001  21.25',

    '1Lt/m 2.00m/s To',

    't=     177.58Lt',

    'Tim=000000h21---',

    '-X',

    '23-12-11 19:54:',

    '56 ID=001  21.25',

    '6Lt/m 2.00m/s To',

    't=     177.93Lt',

    'Tim=000000h21---',

    '-]',

    '23-12-11 19:54:',

    '57 ID=001  21.26',

    '8Lt/m 2.00m/s To',

    't=     178.29Lt',

    'Tim=000000h21---',

    '-a',

    '23-12-11 19:54:',

    '58 ID=001  21.28',

    '4Lt/m 2.00m/s To',

    't=     178.64Lt',

    'Tim=000000h21---',

    '-_',

    '23-12-11 19:54:',

    '59 ID=001  21.30',

    '6Lt/m 2.00m/s To',

    't=     179.00Lt',

    'Tim=000000h21---',

    '-R',

    '23-12-11 19:55:',

    '00 ID=001  21.32',

    '3Lt/m 2.01m/s To',

    't=     179.35Lt',

    'Tim=000000h21---',

    '-M',

    '23-12-11 19:55:',

    '01 ID=001  21.33',

    '2Lt/m 2.01m/s To',

    't=     179.71Lt',

    'Tim=000000h21---',

    '-N',

    '23-12-11 19:55:',

    '02 ID=001  21.33',

    '1Lt/m 2.01m/s To',

    't=     180.06Lt',

    'Tim=000000h21---',

    '-D',

    '23-12-11 19:55:',

    '03 ID=001  21.32',

    '8Lt/m 2.01m/s To',

    't=     180.42Lt',

    'Tim=000000h21---',

    '-K',

    '23-12-11 19:55:',

    '04 ID=001  21.32',

    '9Lt/m 2.01m/s To',

    't=     180.77Lt',

    'Tim=000000h21---',

    '-U',

    '23-12-11 19:55:',

    '05 ID=001  21.33',

    '1Lt/m 2.01m/s To',

    't=     181.13Lt',

    'Tim=000000h21---',

    '-F',

    '23-12-11 19:55:',

    '06 ID=001  21.33',

    '7Lt/m 2.01m/s To',

    't=     181.49Lt',

    'Tim=000000h21---',

    '-V',

    '23-12-11 19:55:',

    '07 ID=001  21.34',

    '2Lt/m 2.01m/s To',

    't=     181.84Lt',

    'Tim=000000h21---',

    '-R',

    '23-12-11 19:55:',

    '08 ID=001  21.33',

    '9Lt/m 2.01m/s To',

    't=     182.20Lt',

    'Tim=000000h21---',

    '-P',

    '23-12-11 19:55:',

    '09 ID=001  21.33',

    '2Lt/m 2.01m/s To',

    't=     182.55Lt',

    'Tim=000000h21---',

    '-R',

    '23-12-11 19:55:',

    '10 ID=001  21.32',

    '1Lt/m 2.01m/s To',

    't=     182.91Lt',

    'Tim=000000h21---',

    '-H',

    '23-12-11 19:55:',

    '11 ID=001  21.30',

    '1Lt/m 2.00m/s To',

    't=     183.26Lt',

    'Tim=000000h21---',

    '-E',

    '23-12-11 19:55:',

    '12 ID=001  21.27',

    '8Lt/m 2.00m/s To',

    't=     183.62Lt',

    'Tim=000000h21---',

    '-S',

    '23-12-11 19:55:',

    '13 ID=001  21.24',

    '9Lt/m 2.00m/s To',

    't=     183.97Lt',

    'Tim=000000h21---',

    '-Z',

    '23-12-11 19:55:',

    '14 ID=001  21.21',

    '8Lt/m 2.00m/s To',

    't=     184.33Lt',

    'Tim=000000h21---',

    '-N',

    '23-12-11 19:55:',

    '15 ID=001  21.18',

    '8Lt/m 1.99m/s To',

    't=     184.68Lt',

    'Tim=000000h21---',

    '-n',

    '23-12-11 19:55:',

    '16 ID=001  21.16',

    '3Lt/m 1.99m/s To',

    't=     185.03Lt',

    'Tim=000000h21---',

    '-^',

    '23-12-11 19:55:',

    '17 ID=001  21.13',

    '9Lt/m 1.99m/s To',

    't=     185.38Lt',

    'Tim=000000h21---',

    '-j',

    '23-12-11 19:55:',

    '18 ID=001  21.11',

    '4Lt/m 1.99m/s To',

    't=     185.74Lt',

    'Tim=000000h21---',

    '-d',

    '23-12-11 19:55:',

    '19 ID=001  21.08',

    '3Lt/m 1.98m/s To',

    't=     186.09Lt',

    'Tim=000000h21---',

    '-h',

    '23-12-11 19:55:',

    '20 ID=001  21.04',

    '4Lt/m 1.98m/s To',

    't=     186.44Lt',

    'Tim=000000h21---',

    "-\'",

    '23-12-11 19:55:',

    '21 ID=001  21.00',

    '3Lt/m 1.98m/s To',

    't=     186.79Lt',

    'Tim=000000h21---',

    '-`',

    '23-12-11 19:55:',

    '22 ID=001  20.96',

    '1Lt/m 1.97m/s To',

    't=     187.14Lt',

    'Tim=000000h21---',

    '-b',

    '23-12-11 19:55:',

    '23 ID=001  20.92',

    '2Lt/m 1.97m/s To',

    't=     187.49Lt',

    'Tim=000000h21---',

    '-h',

    '23-12-11 19:55:',

    '24 ID=001  20.89',

    '1Lt/m 1.97m/s To',

    't=     187.83Lt',

    'Tim=000000h21---',

    '-l',

    '23-12-11 19:55:',

    '25 ID=001  20.86',

    '6Lt/m 1.96m/s To',

    't=     188.18Lt',

    'Tim=000000h21---',

    '-m',

    '23-12-11 19:55:',

    '26 ID=001  20.84',

    '9Lt/m 1.96m/s To',

    't=     188.53Lt',

    'Tim=000000h21---',

    '-n',

    '23-12-11 19:55:',

    '27 ID=001  20.83',

    '5Lt/m 1.96m/s To',

    't=     188.88Lt',

    'Tim=000000h21---',

    '-r',

    '23-12-11 19:55:',

    '28 ID=001  20.81',

    '3Lt/m 1.96m/s To',

    't=     189.22Lt',

    'Tim=000000h21---',

    '-d',

    '23-12-11 19:55:',

    '29 ID=001  20.77',

    '7Lt/m 1.95m/s To',

    't=     189.57Lt',

    'Tim=000000h21---',

    '-u',

    '23-12-11 19:55:',

    '30 ID=001  20.73',

    '0Lt/m 1.95m/s To',

    't=     189.91Lt',

    'Tim=000000h21---',

    '-`',

    '23-12-11 19:55:',

    '31 ID=001  20.67',

    '9Lt/m 1.95m/s To',

    't=     190.26Lt',

    'Tim=000000h21---',

    '-c',

    '23-12-11 19:55:',

    '32 ID=001  20.62',

    '7Lt/m 1.94m/s To',

    't=     190.60Lt',

    'Tim=000000h22---',

    '-[',

    '23-12-11 19:55:',

    '33 ID=001  20.58',

    '3Lt/m 1.94m/s To',

    't=     190.95Lt',

    'Tim=000000h22---',

    '-e',

    '23-12-11 19:55:',

    '34 ID=001  20.54',

    '2Lt/m 1.93m/s To',

    't=     191.29Lt',

    'Tim=000000h22---',

    '-^',

    '23-12-11 19:55:',

    '35 ID=001  20.49',

    '9Lt/m 1.93m/s To',

    't=     191.63Lt',

    'Tim=000000h22—'
];
let flowmeterPort = null;
let flowmeterPortNum = 'COM1';
let flowmeterBaudrate = '9600';

flowmeterPortOpening();

function flowmeterPortOpening() {
    if (!flowmeterPort) {
        flowmeterPort = new SerialPort({
            path: flowmeterPortNum,
            baudRate: parseInt(flowmeterBaudrate, 10),
        });
        flowmeterPort.on('open', flowmeterPortOpen);
        flowmeterPort.on('close', flowmeterPortClose);
        flowmeterPort.on('error', flowmeterPortError);
    }
    else {
        if (flowmeterPort.isOpen) {
            flowmeterPort.close();
            flowmeterPort = null;
            setTimeout(flowmeterPortOpening, 2000);
        }
        else {
            flowmeterPort.open();
        }
    }
}

function flowmeterPortOpen() {
    console.log('flowmeterPort(' + flowmeterPort.path + '), flowmeterPort rate: ' + flowmeterPort.baudRate + ' open.');
}

function flowmeterPortClose() {
    console.log('flowmeterPort closed.');

    setTimeout(flowmeterPortOpening, 2000);
}

function flowmeterPortError(error) {
    console.log('[flowmeterPort error]: ' + error.message);

    setTimeout(flowmeterPortOpening, 2000);
}

let count = 0;
setInterval(()=>{
    if (count < t_data.length) {
        flowmeterPort.write(Buffer.from(t_data[count]));
        count++;
    }
    else {
        count = 0;
    }
},500);
